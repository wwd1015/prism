```{python}
#| label: parameters
#| tags: [parameters]
#| include: false

# Default parameters — overridden by Quarto CLI: quarto render ... -P model_id:my_model
model_id = "credit_risk_model"
report_date = ""
```

```{python}
#| label: setup
#| include: false

import pandas as pd
from pathlib import Path
from IPython.display import HTML, display
from prism import Report, format_badge


def show_chart(fig, height=450):
    """Display a Plotly figure without embedding the full plotly.js library.

    plotly.js is loaded once by the plotly-loader cell below.
    Each chart is just a small data div, keeping the HTML small.
    """
    html = fig.to_html(
        full_html=False,
        include_plotlyjs=False,
        default_height=f"{height}px",
        default_width="100%",
    )
    display(HTML(html))

# Find project root by walking up to the directory containing _quarto.yml
project_root = Path.cwd()
while project_root != project_root.parent:
    if (project_root / "_quarto.yml").exists():
        break
    project_root = project_root.parent

# Load sample data from CSV
data_path = project_root / "data" / "sample_scores.csv"
data = pd.read_csv(data_path)

# Resolve commentary file path
commentary_path = project_root / "config" / "commentary.xlsx"

# Phase 1: Initialize and PRE-COMPUTE everything
report = Report(
    model_id=model_id,
    report_date=report_date,
    config_dir=str(project_root / "config"),
    commentary_file=str(commentary_path),
)
report.compute_all(data=data)


def metric_intro(key, background):
    """Format metric background, intent, thresholds, and current value."""
    mcfg = report.config["metrics"][key]
    thresholds = mcfg["color"]
    value = report.metric_value(key)
    color = report.metric_color(key)
    badge = report.badge(color)

    lines = [background, ""]
    lines.append("| Status | Threshold |")
    lines.append("|--------|-----------|")
    for c in ("green", "yellow", "red"):
        if c in thresholds:
            lines.append(f"| {format_badge(c)} | `{thresholds[c]}` |")
    lines.append("")
    if isinstance(value, float):
        lines.append(f"**Current Value:** `{value:.4f}` {badge}")
    else:
        lines.append(f"**Current Value:** `{value}` {badge}")
    return "\n".join(lines)
```

```{python}
#| label: plotly-loader
#| echo: false
# Load plotly.js once — all show_chart() calls reference this global library.
import plotly
_plotly_js = (Path(plotly.__file__).parent / "package_data" / "plotly.min.js").read_text()
display(HTML(f'<script type="text/javascript">{_plotly_js}</script>'))
del _plotly_js
```
